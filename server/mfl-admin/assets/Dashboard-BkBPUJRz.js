import{B as x,_ as C,s as S,o as p,c as v,a as e,m,r as f,w as k,b as d,d as w,e as O,t as l,F as P,f as j,g as D}from"./index-BcElYNg0.js";import{s as F}from"./index-CkCayRM_.js";import{h as M}from"./ApiService-Y769u1gu.js";import{L as A}from"./LogbookService-DnB3u58k.js";import"./AuthService-C30cchEu.js";var L={root:{position:"relative"}},$={root:"p-chart"},E=x.extend({name:"chart",classes:$,inlineStyles:L}),z={name:"BaseChart",extends:S,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:E,provide:function(){return{$pcChart:this,$parentInstance:this}}},y={name:"Chart",extends:z,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var t=this;C(()=>import("./auto.esm-B7Ao7w_R.js"),[]).then(function(n){t.chart&&(t.chart.destroy(),t.chart=null),n&&n.default&&(t.chart=new n.default(t.$refs.canvas,{type:t.type,data:t.data,options:t.options,plugins:t.plugins})),t.$emit("loaded",t.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(t){if(this.chart){var n=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!1),o=this.chart.getElementsAtEventForMode(t,"dataset",{intersect:!0},!1);n&&n[0]&&o&&this.$emit("select",{originalEvent:t,element:n[0],dataset:o})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function c(s){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(s)}function _(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);t&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,o)}return n}function b(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(o){B(s,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(o){Object.defineProperty(s,o,Object.getOwnPropertyDescriptor(n,o))})}return s}function B(s,t,n){return(t=H(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function H(s){var t=T(s,"string");return c(t)=="symbol"?t:t+""}function T(s,t){if(c(s)!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var o=n.call(s,t||"default");if(c(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var J=["width","height"];function N(s,t,n,o,r,i){return p(),v("div",m({class:s.cx("root"),style:s.sx("root")},s.ptmi("root")),[e("canvas",m({ref:"canvas",width:s.width,height:s.height,onClick:t[0]||(t[0]=function(u){return i.onCanvasClick(u)})},b(b({},s.canvasProps),s.ptm("canvas"))),null,16,J)],16)}y.render=N;const U={className:"card"},V=e("h1",{style:{float:"left"}},"Dashboard",-1),I=e("div",{style:{clear:"both"}},null,-1),q={key:0},G=["innerHTML"],K=e("br",null,null,-1),Y={class:"grid grid-cols-12 gap-8"},R={class:"col-span-12 lg:col-span-6 xl:col-span-3"},Q={class:"card mb-0"},W={class:"flex justify-between mb-4"},X=e("span",{class:"block text-muted-color font-medium mb-4"},"Aktive Sessions",-1),Z={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},tt={class:"facttable"},et=e("td",null,"Jetzt:",-1),st=e("td",null,"Heute:",-1),nt=e("td",null,"7 Tage:",-1),ot=e("div",{class:"flex items-center justify-center bg-blue-100 dark:bg-blue-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-users text-blue-500 !text-xl"})],-1),at={class:"col-span-12 lg:col-span-6 xl:col-span-3"},lt={class:"card mb-0"},it={class:"flex justify-between mb-4"},rt={class:"block text-muted-color font-medium mb-4"},ut={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},ct={class:"facttable"},dt=e("td",null,"Sessions:",-1),ht=e("td",null,"Pilot:innen:",-1),ft=e("td",null,"Dauer:",-1),pt=e("div",{class:"flex items-center justify-center bg-orange-100 dark:bg-orange-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-book text-orange-500 !text-xl"})],-1),vt={class:"col-span-12 lg:col-span-6 xl:col-span-3"},gt={class:"card mb-0"},mt={class:"flex justify-between mb-4"},_t={class:"block text-muted-color font-medium mb-4"},bt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},yt={class:"facttable"},xt=e("td",null,"Anzahl Flüge:",-1),Ct=e("td",null,"Avg Flüge / Session:",-1),St=e("td",null,"Max. Flüge / Session:",-1),kt=e("div",{class:"flex items-center justify-center bg-cyan-100 dark:bg-cyan-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-send text-cyan-500 !text-xl"})],-1),wt={class:"col-span-12 lg:col-span-6 xl:col-span-3"},Ot={class:"card mb-0"},Pt={class:"flex justify-between mb-4"},jt={class:"block text-muted-color font-medium mb-4"},Dt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},Ft={class:"facttable"},Mt=e("td",null,"Vorkommnisse:",-1),At=e("td",null,"Sessions ohne Flug:",-1),Lt=e("td",null,"Vergessene Sessions:",-1),$t=e("div",{class:"flex items-center justify-center bg-purple-100 dark:bg-purple-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-flag text-purple-500 !text-xl"})],-1),Et={class:"col-span-12 xl:col-span-6"},zt={class:"card"},Bt={class:"col-span-12 xl:col-span-6"},Ht={class:"card"},It={__name:"Dashboard",setup(s){const t=f({}),n=f(""),o=f(new Date().getFullYear());k(()=>j.path,r,{immediate:!0});function r(){t.value={sessionsCountJetzt:0,sessionsCountHeute:0,sessionsCount7Tage:0,sessionsCount:0,sessionsUniquePilots:0,sessionDauerMinunten:0,fluegeCount:0,fluegeMaxSession:0,fluegeAvgSession:0,bemerkungenCount:0,automGeschlossenCount:0,sessionsOhneFluegeCount:0,charts:{hours:{options:{responsive:!0,plugins:{legend:{display:!0},title:{display:!0,text:"Auslastung nach Tageszeit ("+o.value+")"}},scales:{y:{display:!1}}},data:{labels:["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],datasets:[{label:"Anzahl Sessions",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}},months:{options:{responsive:!0,plugins:{legend:{display:!0},title:{display:!0,text:"Auslastung nach Monaten ("+o.value+")"}},scales:{y:{display:!1}}},data:{labels:["Jan.","Febr.","März","Apr.","Mai","Juni","Juli","Aug.","Sept.","Okt.","Nov.","Dez."],datasets:[{label:"Anzahl Sessions",data:[0,0,0,0,0,0,0,0,0,0,0,0]}]}}}},A.get(o.value).then(i=>{t.value.openFlightSessions=0;let u=[];i.forEach(a=>{var h=new Date().setHours(0,0,0,0);a.end==null&&(t.value.sessionsCountJetzt=t.value.sessionsCountJetzt+1),new Date(a.start).setHours(0,0,0,0)==h&&(t.value.sessionsCountHeute=t.value.sessionsCountHeute+1),Math.abs((new Date-a.start)/(1e3*60*60*24))<=7&&(t.value.sessionsCount7Tage=t.value.sessionsCount7Tage+1),t.value.sessionsCount=t.value.sessionsCount+1,a.end!=null&&(t.value.sessionDauerMinunten=t.value.sessionDauerMinunten+(a.end-a.start)/(1e3*60)),u[a.pilotid]||(u[a.pilotid]={},t.value.sessionsUniquePilots=t.value.sessionsUniquePilots+1),t.value.fluegeCount=t.value.fluegeCount+a.takeoffcount,a.takeoffcount>t.value.fluegeMaxSession&&(t.value.fluegeMaxSession=a.takeoffcount),t.value.fluegeAvgSession=t.value.fluegeCount/t.value.sessionsCount,a.comment!=null&&a.comment.length>1&&(t.value.bemerkungenCount=t.value.bemerkungenCount+1),a.endedby=="sys"&&(t.value.automGeschlossenCount=t.value.automGeschlossenCount+1),a.takeoffcount<=0&&(t.value.sessionsOhneFluegeCount=t.value.sessionsOhneFluegeCount+1),t.value.charts.hours.data.datasets[0].data[a.start.getHours()]++,t.value.charts.months.data.datasets[0].data[a.start.getMonth()]++})}).catch(i=>M(i,n))}return(i,u)=>{const a=D,h=F,g=y;return p(),v(P,null,[e("div",U,[V,d(a,{onClick:r,icon:"pi pi-refresh",severity:"secondary",style:{float:"right"}}),I]),n.value.length>0?(p(),v("div",q,[d(h,{severity:"error",closable:!0},{default:w(()=>[e("div",{innerHTML:n.value},null,8,G)]),_:1}),K])):O("",!0),e("div",Y,[e("div",R,[e("div",Q,[e("div",W,[e("div",null,[X,e("div",Z,[e("table",tt,[e("tr",null,[et,e("td",null,l(t.value.sessionsCountJetzt),1)]),e("tr",null,[st,e("td",null,l(t.value.sessionsCountHeute),1)]),e("tr",null,[nt,e("td",null,l(t.value.sessionsCount7Tage),1)])])])]),ot])])]),e("div",at,[e("div",lt,[e("div",it,[e("div",null,[e("span",rt,"Flugbuch "+l(o.value),1),e("div",ut,[e("table",ct,[e("tr",null,[dt,e("td",null,l(t.value.sessionsCount.toLocaleString()),1)]),e("tr",null,[ht,e("td",null,l(t.value.sessionsUniquePilots.toLocaleString()),1)]),e("tr",null,[ft,e("td",null,l((t.value.sessionDauerMinunten/60).toFixed(0))+" Std.",1)])])])]),pt])])]),e("div",vt,[e("div",gt,[e("div",mt,[e("div",null,[e("span",_t,"Flüge "+l(o.value),1),e("div",bt,[e("table",yt,[e("tr",null,[xt,e("td",null,l(t.value.fluegeCount.toLocaleString()),1)]),e("tr",null,[Ct,e("td",null,l(t.value.fluegeAvgSession.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2})),1)]),e("tr",null,[St,e("td",null,l(t.value.fluegeMaxSession.toLocaleString()),1)])])])]),kt])])]),e("div",wt,[e("div",Ot,[e("div",Pt,[e("div",null,[e("span",jt,"Sonstiges "+l(o.value),1),e("div",Dt,[e("table",Ft,[e("tr",null,[Mt,e("td",null,l(t.value.bemerkungenCount.toLocaleString()),1)]),e("tr",null,[At,e("td",null,l(t.value.sessionsOhneFluegeCount.toLocaleString()),1)]),e("tr",null,[Lt,e("td",null,l(t.value.automGeschlossenCount.toLocaleString()),1)])])])]),$t])])]),e("div",Et,[e("div",zt,[d(g,{type:"bar",data:t.value.charts.hours.data,options:t.value.charts.hours.options},null,8,["data","options"])])]),e("div",Bt,[e("div",Ht,[d(g,{type:"bar",data:t.value.charts.months.data,options:t.value.charts.months.options},null,8,["data","options"])])])])],64)}}};export{It as default};
