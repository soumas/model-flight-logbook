import{B as S,_ as k,s as w,o as m,c as g,a as e,m as _,r as f,w as D,b as p,d as O,e as P,t as l,F as j,f as F}from"./index-DlkIVmzw.js";import{s as M}from"./index-BWqVtdZN.js";import{s as A}from"./index-DRph5D9K.js";import{h as L}from"./ApiService-C0tcMn-D.js";import{L as $}from"./LogbookService-CTHnMPmP.js";import"./AuthService-DO9SXOvK.js";var E={root:{position:"relative"}},z={root:"p-chart"},H=S.extend({name:"chart",classes:z,inlineStyles:E}),T={name:"BaseChart",extends:w,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:H,provide:function(){return{$pcChart:this,$parentInstance:this}}},x={name:"Chart",extends:T,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var t=this;k(()=>import("./auto.esm-B7Ao7w_R.js"),[]).then(function(n){t.chart&&(t.chart.destroy(),t.chart=null),n&&n.default&&(t.chart=new n.default(t.$refs.canvas,{type:t.type,data:t.data,options:t.options,plugins:t.plugins})),t.$emit("loaded",t.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(t){if(this.chart){var n=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!1),o=this.chart.getElementsAtEventForMode(t,"dataset",{intersect:!0},!1);n&&n[0]&&o&&this.$emit("select",{originalEvent:t,element:n[0],dataset:o})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function c(s){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(s)}function b(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),n.push.apply(n,o)}return n}function y(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(o){B(s,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(o){Object.defineProperty(s,o,Object.getOwnPropertyDescriptor(n,o))})}return s}function B(s,t,n){return(t=V(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function V(s){var t=J(s,"string");return c(t)=="symbol"?t:t+""}function J(s,t){if(c(s)!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var o=n.call(s,t||"default");if(c(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var N=["width","height"];function U(s,t,n,o,d,h){return m(),g("div",_({class:s.cx("root"),style:s.sx("root")},s.ptmi("root")),[e("canvas",_({ref:"canvas",width:s.width,height:s.height,onClick:t[0]||(t[0]=function(i){return h.onCanvasClick(i)})},y(y({},s.canvasProps),s.ptm("canvas"))),null,16,N)],16)}x.render=U;const I={className:"card"},q=e("h1",{style:{float:"left"}},"Dashboard",-1),G=e("div",{style:{clear:"both"}},null,-1),Y={key:0},K=["innerHTML"],R=e("br",null,null,-1),Q={class:"grid grid-cols-12 gap-8"},W={class:"col-span-12 lg:col-span-6 xl:col-span-3"},X={class:"card mb-0"},Z={class:"flex justify-between mb-4"},tt=e("span",{class:"block text-muted-color font-medium mb-4"},"Aktive Sessions",-1),et={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},st={class:"facttable"},nt=e("td",null,"Jetzt:",-1),ot=e("td",null,"Heute:",-1),at=e("td",null,"7 Tage:",-1),lt=e("div",{class:"flex items-center justify-center bg-blue-100 dark:bg-blue-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-users text-blue-500 !text-xl"})],-1),it={class:"col-span-12 lg:col-span-6 xl:col-span-3"},rt={class:"card mb-0"},ut={class:"flex justify-between mb-4"},ct={class:"block text-muted-color font-medium mb-4"},dt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},ht={class:"facttable"},ft=e("td",null,"Sessions:",-1),pt=e("td",null,"Pilot:innen:",-1),vt=e("td",null,"Dauer:",-1),mt=e("div",{class:"flex items-center justify-center bg-orange-100 dark:bg-orange-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-book text-orange-500 !text-xl"})],-1),gt={class:"col-span-12 lg:col-span-6 xl:col-span-3"},_t={class:"card mb-0"},bt={class:"flex justify-between mb-4"},yt={class:"block text-muted-color font-medium mb-4"},xt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},Ct={class:"facttable"},St=e("td",null,"Anzahl Flüge:",-1),kt=e("td",null,"Avg Flüge / Session:",-1),wt=e("td",null,"Max. Flüge / Session:",-1),Dt=e("div",{class:"flex items-center justify-center bg-cyan-100 dark:bg-cyan-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-send text-cyan-500 !text-xl"})],-1),Ot={class:"col-span-12 lg:col-span-6 xl:col-span-3"},Pt={class:"card mb-0"},jt={class:"flex justify-between mb-4"},Ft={class:"block text-muted-color font-medium mb-4"},Mt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},At={class:"facttable"},Lt=e("td",null,"Vorkommnisse:",-1),$t=e("td",null,"Sessions ohne Flug:",-1),Et=e("td",null,"Vergessene Sessions:",-1),zt=e("div",{class:"flex items-center justify-center bg-purple-100 dark:bg-purple-400/10 rounded-border",style:{width:"2.5rem",height:"2.5rem"}},[e("i",{class:"pi pi-flag text-purple-500 !text-xl"})],-1),Ht={class:"col-span-12 xl:col-span-6"},Tt={class:"card"},Bt={class:"col-span-12 xl:col-span-6"},Vt={class:"card"},Yt={__name:"Dashboard",setup(s){const t=f({}),n=f(""),o=f(new Date().getFullYear()),d=f(Array.from({length:new Date().getFullYear()-2024+1},(i,r)=>new Date().getFullYear()-r));D(()=>F.path,h,{immediate:!0});function h(){t.value={sessionsCountJetzt:0,sessionsCountHeute:0,sessionsCount7Tage:0,sessionsCount:0,sessionsUniquePilots:0,sessionDauerMinunten:0,fluegeCount:0,fluegeMaxSession:0,fluegeAvgSession:0,bemerkungenCount:0,automGeschlossenCount:0,sessionsOhneFluegeCount:0,charts:{hours:{options:{responsive:!0,plugins:{legend:{display:!0},title:{display:!0,text:"Auslastung nach Tageszeit ("+o.value+")"}},scales:{y:{display:!1}}},data:{labels:["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],datasets:[{label:"Anzahl Sessions",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}},months:{options:{responsive:!0,plugins:{legend:{display:!0},title:{display:!0,text:"Auslastung nach Monaten ("+o.value+")"}},scales:{y:{display:!1}}},data:{labels:["Jan.","Febr.","März","Apr.","Mai","Juni","Juli","Aug.","Sept.","Okt.","Nov.","Dez."],datasets:[{label:"Anzahl Sessions",data:[0,0,0,0,0,0,0,0,0,0,0,0]}]}}}},$.get(o.value).then(i=>{t.value.openFlightSessions=0;let r=[];i.forEach(a=>{var v=new Date().setHours(0,0,0,0);if(a.end==null&&(t.value.sessionsCountJetzt=t.value.sessionsCountJetzt+1),new Date(a.start).setHours(0,0,0,0)==v&&(t.value.sessionsCountHeute=t.value.sessionsCountHeute+1),Math.abs((new Date-a.start)/(1e3*60*60*24))<=7&&(t.value.sessionsCount7Tage=t.value.sessionsCount7Tage+1),t.value.sessionsCount=t.value.sessionsCount+1,a.end!=null){let u=(a.end-a.start)/6e4;u>0?t.value.sessionDauerMinunten=t.value.sessionDauerMinunten+u:console.error("Session ID "+a.id+" hat negative Dauer: start="+a.start+" end="+a.end)}r[a.pilotid]||(r[a.pilotid]={},t.value.sessionsUniquePilots=t.value.sessionsUniquePilots+1),t.value.fluegeCount=t.value.fluegeCount+a.takeoffcount,a.takeoffcount>t.value.fluegeMaxSession&&(t.value.fluegeMaxSession=a.takeoffcount),t.value.fluegeAvgSession=t.value.fluegeCount/t.value.sessionsCount,a.comment!=null&&a.comment.length>1&&(t.value.bemerkungenCount=t.value.bemerkungenCount+1),a.endedby=="sys"&&(t.value.automGeschlossenCount=t.value.automGeschlossenCount+1),a.takeoffcount<=0&&(t.value.sessionsOhneFluegeCount=t.value.sessionsOhneFluegeCount+1),t.value.charts.hours.data.datasets[0].data[a.start.getHours()]++,t.value.charts.months.data.datasets[0].data[a.start.getMonth()]++})}).catch(i=>L(i,n))}return(i,r)=>{const a=A,v=M,u=x;return m(),g(j,null,[e("div",I,[q,p(a,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=C=>o.value=C),options:d.value,onChange:h,style:{float:"right"}},null,8,["modelValue","options"]),G]),n.value.length>0?(m(),g("div",Y,[p(v,{severity:"error",closable:!0},{default:O(()=>[e("div",{innerHTML:n.value},null,8,K)]),_:1}),R])):P("",!0),e("div",Q,[e("div",W,[e("div",X,[e("div",Z,[e("div",null,[tt,e("div",et,[e("table",st,[e("tr",null,[nt,e("td",null,l(t.value.sessionsCountJetzt),1)]),e("tr",null,[ot,e("td",null,l(t.value.sessionsCountHeute),1)]),e("tr",null,[at,e("td",null,l(t.value.sessionsCount7Tage),1)])])])]),lt])])]),e("div",it,[e("div",rt,[e("div",ut,[e("div",null,[e("span",ct,"Flugbuch "+l(o.value),1),e("div",dt,[e("table",ht,[e("tr",null,[ft,e("td",null,l(t.value.sessionsCount.toLocaleString()),1)]),e("tr",null,[pt,e("td",null,l(t.value.sessionsUniquePilots.toLocaleString()),1)]),e("tr",null,[vt,e("td",null,l((t.value.sessionDauerMinunten/60).toFixed(0))+" Std.",1)])])])]),mt])])]),e("div",gt,[e("div",_t,[e("div",bt,[e("div",null,[e("span",yt,"Flüge "+l(o.value),1),e("div",xt,[e("table",Ct,[e("tr",null,[St,e("td",null,l(t.value.fluegeCount.toLocaleString()),1)]),e("tr",null,[kt,e("td",null,l(t.value.fluegeAvgSession.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2})),1)]),e("tr",null,[wt,e("td",null,l(t.value.fluegeMaxSession.toLocaleString()),1)])])])]),Dt])])]),e("div",Ot,[e("div",Pt,[e("div",jt,[e("div",null,[e("span",Ft,"Sonstiges "+l(o.value),1),e("div",Mt,[e("table",At,[e("tr",null,[Lt,e("td",null,l(t.value.bemerkungenCount.toLocaleString()),1)]),e("tr",null,[$t,e("td",null,l(t.value.sessionsOhneFluegeCount.toLocaleString()),1)]),e("tr",null,[Et,e("td",null,l(t.value.automGeschlossenCount.toLocaleString()),1)])])])]),zt])])]),e("div",Ht,[e("div",Tt,[p(u,{type:"bar",data:t.value.charts.hours.data,options:t.value.charts.hours.options},null,8,["data","options"])])]),e("div",Bt,[e("div",Vt,[p(u,{type:"bar",data:t.value.charts.months.data,options:t.value.charts.months.options},null,8,["data","options"])])])])],64)}}};export{Yt as default};
